package com.justmediagroup.es.usuario.service.impl;

import java.util.UUID;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.justmediagroup.es.usuario.repository.contract.ITransaccionesWeb;
import com.justmediagroup.es.usuario.repository.contract.IUsuarioRepository;
import com.justmediagroup.es.usuario.repository.contract.IValoresConfigurablesRepository;
import com.justmediagroup.es.usuario.repository.model.TransaccionesWeb;
import com.justmediagroup.es.usuario.repository.model.Usuario;
import com.justmediagroup.es.usuario.service.contract.IUsuarioSvc;
import com.justmediagroup.es.usuario.utils.TransaccionConvert;
import com.justmediagroup.es.usuario.utils.UsuarioConvert;
import com.justmediagroup.logica_comun.exception.BusinessException;
import com.justmediagroup.logica_comun.exception.TipoError;
import com.justmediagroup.modelo_canonico.TransaccionesType;
import com.justmediagroup.modelo_canonico.UsuarioType;
import com.justmediagroup.modelo_canonico.ValoresConfigurablesType;

/**
 * @author jesus
 *
 */

@Service
public class UsuarioSvcImpl implements IUsuarioSvc {

	@Autowired
	IUsuarioRepository usuarioRepository;

	@Autowired
	ObjectMapper mapperJson;
	
	@Autowired
	ITransaccionesWeb transaccionWebRepository;
	
	@Autowired
	IValoresConfigurablesRepository valoresConfigurablesRepository;
	
	

	@Override
	public UsuarioType consultarUsuarioPorEmail(String correo) throws BusinessException {
		Usuario usuario;
		usuario = usuarioRepository.consultarUsuarioPorCorreo(correo);
		if (usuario == null) {
			throw new BusinessException("EL RECURSO NO FUE ENCONTRADO", TipoError.NO_ENCONTRADO);
		}
		return UsuarioConvert.convertModelToType(usuario);
	}

	@Override
	public UsuarioType crearUsuario(UsuarioType usuarioType) throws BusinessException {
		if (usuarioType == null) {
			throw new BusinessException("EL RECURSO NO PUEDE SER NULO", TipoError.SOLICITUD_INVALIDA);
		}
		Usuario usuario;
		usuarioType.setId(null);
		usuario = usuarioRepository.save(UsuarioConvert.convertTypeToModel(usuarioType));
		return UsuarioConvert.convertModelToType(usuario);
	}

	@Override
	public UsuarioType modificarUsuario(UsuarioType usuarioType) throws BusinessException {
		UUID usuarioId = UUID.fromString(usuarioType.getId());
		if (usuarioRepository.existsById(usuarioId)) {
			throw new BusinessException(String.format("USUARIO CON ID [%s] no encontrado", usuarioType.getId()),
					TipoError.NO_ENCONTRADO);
		}
		Usuario usuario;
		usuario = usuarioRepository.save(UsuarioConvert.convertTypeToModel(usuarioType));
		return UsuarioConvert.convertModelToType(usuario);
	}

	@Override
	public TransaccionesType consultarTransaccionPorUsuario(String usuarioId, String enlace) throws BusinessException {
		TransaccionesWeb transaccion;
		transaccion = transaccionWebRepository.consultarTransaccionPorUsuarioId(usuarioId, enlace);
		if(transaccion ==  null){
			throw new BusinessException("RECURSO NO ENCONTRADO", TipoError.NO_ENCONTRADO);
		}
		return TransaccionConvert.modelToType(transaccion);
	}

	@Override
	public TransaccionesType crearTransaccion(TransaccionesType transaccion) throws BusinessException {
		if(transaccion == null) {
			throw new BusinessException("EL RECURSO NO PUEDE SER NULO",TipoError.SOLICITUD_INVALIDA);
		}
		transaccion.setIdAcceso(null);
		TransaccionesWeb transaccionWeb;
		transaccionWeb = transaccionWebRepository.save(TransaccionConvert.typeToModel(transaccion));
		return TransaccionConvert.modelToType(transaccionWeb);
	}

	@Override
	public TransaccionesType modificarTransaccion(TransaccionesType transaccion) throws BusinessException {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public ValoresConfigurablesType consultarValorConfigurable(String nombre) throws BusinessException {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public TransaccionesType crearValorConfigurable(ValoresConfigurablesType valorConfigurable)
			throws BusinessException {
		// TODO Auto-generated method stub
		return null;
	}

	
	



}
